name: Test

on:
  workflow_dispatch:
  push:
    paths:
      - "**/Dockerfile"
      - "**/scripts/**"
      - ".github/workflows/test.yml"
      - "reference-project-test/**"
  pull_request:
    paths:
      - "**/Dockerfile"
      - "**/scripts/**"
      - ".github/workflows/test.yml"
      - "reference-project-test/**"

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  ##########################
  #      Test Backend      #
  ##########################
  reportingTest:
    # Only run if not a PR as we need access to secrets
    if: github.base_ref == ''
    name: "ðŸ§ª Test reporting system (${{ matrix.imageType }})"
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        jobId:
          - dryRun # specifically use `dryRun` for testing.
        imageType:
          - base
          - hub
          - editor
        baseOs:
          - ubuntu
        repoVersion:
          - 0.1
        include:
          - imageType: editor
            editorVersion: 2020.1.4f1
            targetPlatform: android
    steps:
      - name: Checkout
        uses: actions/checkout@v5
